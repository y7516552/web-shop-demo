"use strict";(self["webpackChunkweb_shop_demo"]=self["webpackChunkweb_shop_demo"]||[]).push([[883],{883:function(e,t,s){s.r(t),s.d(t,{default:function(){return ue}});var a=s(3396),o=s(7139),i=s(9242);const l={key:0},r={class:"d-flex justify-content-between"},n=(0,a._)("p",{class:"fs-4 text-muted"},"付款",-1),d=(0,a._)("p",{class:"fs-4 text-muted"},"完成",-1),c={key:0,class:"progress"},u=(0,a._)("div",{class:"progress-bar progress-bar-striped bg-warning",role:"progressbar",style:{width:"25%"},"aria-valuenow":"25","aria-valuemin":"0","aria-valuemax":"100"},null,-1),p=[u],m={key:1,class:"progress"},h=(0,a._)("div",{class:"progress-bar progress-bar-striped bg-warning",role:"progressbar",style:{width:"50%"},"aria-valuenow":"50","aria-valuemin":"0","aria-valuemax":"100"},null,-1),g=[h],b={class:"row mt-5"},f={key:0,class:"col-12"},v={class:"cart-clear-veiw"},_=(0,a._)("div",{class:"logo-icon"},null,-1),k=(0,a._)("p",{class:"fs-1"},"目前購物車內是空的喔...",-1),C=(0,a._)("p",{class:"fs-6 text-black-50"},"好可惜喔，這樣沒辦法開車耶。",-1),w={key:1,class:"col-12 col-md-5"},y={class:"table align-middle"},x=(0,a._)("thead",null,[(0,a._)("tr",null,[(0,a._)("th"),(0,a._)("th",null,"名稱"),(0,a._)("th",{style:{width:"120px"}},"數量"),(0,a._)("th",null,"單價")])],-1),q=["onClick"],U=(0,a._)("i",{class:"bi bi-x"},null,-1),V=[U],$={key:0,class:"text-success"},D={key:0,class:"input-group input-group-sm"},L=["onUpdate:modelValue","disabled","onChange"],S={class:"input-group-text"},W={key:1,class:"d-flex"},M={key:0,class:"text-success"},P=(0,a._)("td",{colspan:"3",class:"text-end"},"總計",-1),z={class:"text-end"},I={key:0},Z=(0,a._)("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),j={class:"text-end text-success"},A={key:1,class:"input-group mb-3 input-group-sm"},T={class:"input-group-append"},E={key:2,class:"d-flex justify-content-end mb-3"},H={key:2,class:"col-12 col-md-7"},O={key:0,class:"container p-3"},Y={class:"mb-3"},K=(0,a._)("label",{for:"email",class:"form-label"},"Email",-1),B={class:"mb-3"},F=(0,a._)("label",{for:"name",class:"form-label"},"收件人姓名",-1),G={class:"mb-3"},J=(0,a._)("label",{for:"tel",class:"form-label"},"收件人電話",-1),N={class:"mb-3"},Q=(0,a._)("label",{for:"pickup",class:"form-label"},"自取或外送",-1),R=["checked"],X=["checked"],ee={key:0,class:"mb-3"},te=(0,a._)("label",{for:"address",class:"form-label"},"收件人地址",-1),se={class:"mb-3"},ae=(0,a._)("label",{for:"message",class:"form-label"},"留言",-1),oe={class:"mb-3 d-flex justify-content-between"},ie=["onClick"];function le(e,t,s,u,h,U){const le=(0,a.up)("loading-component"),re=(0,a.up)("vee-field"),ne=(0,a.up)("error-message"),de=(0,a.up)("vee-form");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(le,{active:h.isLoading},null,8,["active"]),h.cartShow?((0,a.wg)(),(0,a.iD)("div",l,[(0,a._)("div",r,[(0,a._)("p",{class:(0,o.C_)({"fs-4":h.cartConfirm,"fs-2":!h.cartConfirm,"fw-bold":!h.cartConfirm})},"確認訂單",2),(0,a._)("p",{class:(0,o.C_)({"fs-4":!h.cartConfirm,"text-muted":!h.cartConfirm,"fs-2":h.cartConfirm,"fw-bold":h.cartConfirm})},"填寫資料",2),n,d]),h.cartConfirm?((0,a.wg)(),(0,a.iD)("div",m,g)):((0,a.wg)(),(0,a.iD)("div",c,p))])):(0,a.kq)("",!0),(0,a._)("div",b,[h.cartShow?((0,a.wg)(),(0,a.iD)("div",w,[h.cartConfirm?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("button",{key:0,type:"button",class:"btn btn-danger",onClick:t[1]||(t[1]=(0,i.iM)(((...e)=>U.deleteAllCart&&U.deleteAllCart(...e)),["prevent"]))},"清空購物車")),(0,a._)("table",y,[x,(0,a._)("tbody",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(h.cart.carts,(t=>((0,a.wg)(),(0,a.iD)("tr",{key:t.id},[(0,a._)("td",null,[h.cartConfirm?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("button",{key:0,type:"button",class:"btn btn-outline-danger btn-sm",onClick:(0,i.iM)((e=>U.deleteCart(t.id)),["prevent"])},V,8,q))]),(0,a._)("td",null,[(0,a.Uk)((0,o.zw)(t.product.title)+" ",1),t.coupon?((0,a.wg)(),(0,a.iD)("div",$," 已套用優惠券 "+(0,o.zw)(t.coupon.title),1)):(0,a.kq)("",!0)]),(0,a._)("td",null,[h.cartConfirm?((0,a.wg)(),(0,a.iD)("div",W,(0,o.zw)(t.qty)+" / "+(0,o.zw)(t.product.unit),1)):((0,a.wg)(),(0,a.iD)("div",D,[(0,a.wy)((0,a._)("input",{type:"number",class:"form-control","onUpdate:modelValue":e=>t.qty=e,min:"1",disabled:t.id===h.status.loadingItem,onChange:e=>U.updateCart(t)},null,40,L),[[i.nr,t.qty]]),(0,a._)("div",S,"/ "+(0,o.zw)(t.product.unit),1)]))]),(0,a._)("td",null,[t.coupon?((0,a.wg)(),(0,a.iD)("small",M,"折扣價：")):(0,a.kq)("",!0),(0,a.Uk)((0,o.zw)(e.$filters.currency(t.final_total))+" 元",1)])])))),128))]),(0,a._)("tfoot",null,[(0,a._)("tr",null,[P,(0,a._)("td",z,(0,o.zw)(e.$filters.currency(h.cart.total))+" 元",1)]),h.cart.total>h.cart.final_total?((0,a.wg)(),(0,a.iD)("tr",I,[Z,(0,a._)("td",j,(0,o.zw)(e.$filters.currency(h.cart.final_total)),1)])):(0,a.kq)("",!0)])]),h.cartConfirm?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("div",A,[(0,a.wy)((0,a._)("input",{type:"text",class:"form-control",placeholder:"請輸入優惠碼","onUpdate:modelValue":t[2]||(t[2]=e=>h.voucherCode=e)},null,512),[[i.nr,h.voucherCode]]),(0,a._)("div",T,[(0,a._)("button",{class:"btn btn-outline-secondary",type:"button",onClick:t[3]||(t[3]=(0,i.iM)(((...e)=>U.addVoucherCode&&U.addVoucherCode(...e)),["prevent"]))}," 套用優惠碼 ")])])),h.cartConfirm?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("div",E,[(0,a._)("button",{class:"btn btn-primary",onClick:t[4]||(t[4]=(0,i.iM)((e=>h.cartConfirm=!0),["prevent"]))},"下一步")]))])):((0,a.wg)(),(0,a.iD)("div",f,[(0,a._)("div",v,[_,k,C,(0,a._)("button",{class:"btn btn-dark",onClickPassive:t[0]||(t[0]=e=>U.pushToProduct())},"重新上車",32)])])),h.cartShow?((0,a.wg)(),(0,a.iD)("div",H,[h.cartConfirm?((0,a.wg)(),(0,a.iD)("div",O,[(0,a.Wm)(de,{onSubmit:U.createOrder},{default:(0,a.w5)((({errors:e,validate:s})=>[(0,a._)("div",Y,[K,(0,a.Wm)(re,{type:"email",class:(0,o.C_)(["form-control",{"is-invalid":e["email"]}]),id:"email",placeholder:"請輸入Email",name:"email",required:"",rules:"email|required",modelValue:h.form.user.email,"onUpdate:modelValue":t[5]||(t[5]=e=>h.form.user.email=e)},null,8,["class","modelValue"]),(0,a.Wm)(ne,{name:"email",class:"invalid-feedback"})]),(0,a._)("div",B,[F,(0,a.Wm)(re,{type:"text",class:(0,o.C_)(["form-control",{"is-invalid":e["name"]}]),id:"name",placeholder:"請輸入姓名",name:"name",required:"",rules:"required",modelValue:h.form.user.name,"onUpdate:modelValue":t[6]||(t[6]=e=>h.form.user.name=e)},null,8,["class","modelValue"]),(0,a.Wm)(ne,{name:"name",class:"invalid-feedback"})]),(0,a._)("div",G,[J,(0,a.Wm)(re,{type:"text",class:(0,o.C_)(["form-control",{"is-invalid":e["tel"]}]),id:"tel",placeholder:"請輸入電話",name:"tel",required:"",rules:U.isPhone,modelValue:h.form.user.tel,"onUpdate:modelValue":t[7]||(t[7]=e=>h.form.user.tel=e)},null,8,["rules","class","modelValue"]),(0,a.Wm)(ne,{name:"tel",class:"invalid-feedback"})]),(0,a._)("div",N,[Q,(0,a._)("button",{class:"btn btn-primary form-control mb-1",type:"button",name:"pickUp",onClick:t[8]||(t[8]=(0,i.iM)((e=>h.pickUp=!0),["prevent"])),checked:h.pickUp},"自取",8,R),(0,a._)("button",{class:(0,o.C_)(["btn btn-primary form-control mb-1",{active:!h.pickUp}]),type:"button",name:"pickUp",onClick:t[9]||(t[9]=(0,i.iM)((e=>h.pickUp=!1),["prevent"])),checked:!h.pickUp},"外送",10,X)]),h.pickUp?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("div",ee,[te,(0,a.Wm)(re,{type:"text",class:(0,o.C_)(["form-control",{"is-invalid":e["address"]}]),id:"address",placeholder:"請輸入收件地址",name:"address",required:"",rules:U.addressValidate,disabled:h.pickUp,modelValue:h.form.user.address,"onUpdate:modelValue":t[10]||(t[10]=e=>h.form.user.address=e)},null,8,["rules","class","disabled","modelValue"]),(0,a.Wm)(ne,{name:"address",class:"invalid-feedback"})])),(0,a._)("div",se,[ae,(0,a.Wm)(re,{class:"form-control",id:"message",rows:"3",name:"message",modelValue:h.form.message,"onUpdate:modelValue":t[11]||(t[11]=e=>h.form.message=e)},null,8,["modelValue"])]),(0,a._)("div",oe,[(0,a._)("button",{class:"btn btn-primary",onClick:t[12]||(t[12]=(0,i.iM)((e=>h.cartConfirm=!1),["prevent"]))},"上一步"),(0,a._)("button",{type:"submit",class:"btn btn-primary ms-auto",onClick:s},"送出訂單",8,ie)])])),_:1},8,["onSubmit"])])):(0,a.kq)("",!0)])):(0,a.kq)("",!0)])],64)}var re=s(5820),ne={data(){return{products:[],product:{},status:{loadingItem:""},isLoading:!1,pagination:{},cart:{},cartShow:!1,cartConfirm:!1,voucherCode:"",pickUp:!1,form:{user:{name:"",email:"",tel:"",address:"台中市"},message:""}}},provide(){return{emitter:re.Z}},watch:{pickUp(){this.pickUp?this.form.user.address="塔可餅車車自取":this.pickUp||(this.form.user.address="")}},methods:{getProducts(e=1){const t=`https://vue3-course-api.hexschool.io/api/steven-vue3-demo/products/?page=${e}`;this.isLoading=!0,this.$http.get(t).then((e=>{this.products=e.data.products,this.pagination=e.data.pagination,this.isLoading=!1}))},getProduct(e){this.$router.push(`/user/product/${e}`)},addCart(e){const t="https://vue3-course-api.hexschool.io/api/steven-vue3-demo/cart";this.status.loadingItem=e;const s={product_id:e,qty:1};this.$http.post(t,{data:s}).then((e=>{console.log(e),re.Z.emit("updateCart"),this.status.loadingItem="",this.getCart()}))},getCart(){const e="https://vue3-course-api.hexschool.io/api/steven-vue3-demo/cart";this.isLoading=!0,this.$http.get(e).then((e=>{console.log(e.data),this.cart=e.data.data,this.isLoading=!1,this.cartShow=!1,e.data.data.carts.length>0&&(this.cartShow=!0)}))},updateCart(e){const t=`https://vue3-course-api.hexschool.io/api/steven-vue3-demo/cart/${e.id}`,s={product_id:e.product_id,qty:e.qty};this.isLoading=!0,this.status.loadingItem=e.id,this.$http.put(t,{data:s}).then((e=>{this.isLoading=!1,this.getCart(),this.status.loadingItem=""}))},deleteCart(e){const t=`https://vue3-course-api.hexschool.io/api/steven-vue3-demo/cart/${e}`;this.isLoading=!0,this.$http.delete(t).then((e=>{this.isLoading=!1,re.Z.emit("updateCart"),this.getCart()}))},deleteAllCart(){const e="https://vue3-course-api.hexschool.io/api/steven-vue3-demo/carts";this.isLoading=!0,this.$http.delete(e).then((e=>{this.$httpMessageState(e,"清空購物車"),this.isLoading=!1,re.Z.emit("updateCart"),this.getCart(),this.pushToProduct()}))},addVoucherCode(){const e="https://vue3-course-api.hexschool.io/api/steven-vue3-demo/coupon",t={code:this.voucherCode};this.isLoading=!0,this.$http.post(e,{data:t}).then((e=>{console.log(e),this.$httpMessageState(e,"使用優惠券"),this.isLoading=!1,this.getCart()}))},createOrder(){const e="https://vue3-course-api.hexschool.io/api/steven-vue3-demo/order",t=this.form;this.isLoading=!0,this.$http.post(e,{data:t}).then((e=>{console.log(e.data.orderId),this.$httpMessageState(e,"新增訂單"),this.isLoading=!1,this.getCart(),this.form={user:{name:"",email:"",tel:"",address:""},message:""},this.$router.push(`/user/checkout/${e.data.orderId}`)}))},isPhone(e){const t=/^(09)[0-9]{8}$/;return!!t.test(e)||"手機號碼格式錯誤"},addressValidate(e){const t=/^台中市/;return!!t.test(e)||"外送限定台中市"},pushToProduct(){this.$router.push("/user/product")}},created(){this.getProducts(),this.getCart()}},de=s(89);const ce=(0,de.Z)(ne,[["render",le]]);var ue=ce}}]);
//# sourceMappingURL=883.d5f9999c.js.map