"use strict";(self["webpackChunkweb_shop_demo"]=self["webpackChunkweb_shop_demo"]||[]).push([[627],{9637:function(e,t,a){a.d(t,{Z:function(){return v}});var s=a(3396),l=a(7139),i=a(9242);const o={"aria-label":"Page navigation example"},n={class:"pagination justify-content-center"},r=(0,s._)("span",{"aria-hidden":"true"},"«",-1),d=[r],c=["onClick"],u=(0,s._)("span",{"aria-hidden":"true"},"»",-1),p=[u];function m(e,t,a,r,u,m){return(0,s.wg)(),(0,s.iD)("nav",o,[(0,s._)("ul",n,[(0,s._)("li",{class:(0,l.C_)(["page-item",{disabled:!a.pages.has_pre}])},[(0,s._)("a",{class:"page-link",href:"#","aria-label":"Previous",onClick:t[0]||(t[0]=(0,i.iM)((e=>m.changePage(-1)),["prevent"]))},d)],2),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(a.pages.total_pages,(e=>((0,s.wg)(),(0,s.iD)("li",{class:(0,l.C_)(["page-item",{active:e===a.pages.current_page}]),key:e},[(0,s._)("a",{class:"page-link",href:"#",onClick:(0,i.iM)((t=>m.updatePages(e)),["prevent"])},(0,l.zw)(e),9,c)],2)))),128)),(0,s._)("li",{class:(0,l.C_)(["page-item",{disabled:!a.pages.has_next}])},[(0,s._)("a",{class:"page-link",href:"#","aria-label":"Next",onClick:t[1]||(t[1]=(0,i.iM)((e=>m.changePage(1)),["prevent"]))},p)],2)])])}var h={props:["pages"],methods:{updatePages(e){this.$emit("emit-pages",e)},changePage(e){this.$emit("emit-pages",this.pages.current_page+e)}}},g=a(89);const _=(0,g.Z)(h,[["render",m]]);var v=_},9627:function(e,t,a){a.r(t),a.d(t,{default:function(){return ce}});var s=a(3396),l=a(7139),i=a(9242);const o={class:"row"},n={class:"col-12 col-md-7"},r={class:"container"},d={class:"row mt-4 px-2"},c={class:"table align-middle"},u=(0,s._)("thead",null,[(0,s._)("tr",null,[(0,s._)("th",null,"圖片"),(0,s._)("th",null,"商品名稱"),(0,s._)("th",null,"價格"),(0,s._)("th")])],-1),p={style:{width:"200px"}},m={href:"#",class:"text-dark"},h={key:0,class:"h5"},g={key:1,class:"h6"},_={key:2,class:"h5"},v={class:"btn-group btn-group-sm"},b=["onClick"],f=["disabled","onClick"],k={key:0,class:"spinner-border text-danger spinner-grow-sm",role:"status"},C=(0,s._)("span",{class:"visually-hidden"},"Loading...",-1),y=[C],w=(0,s.Uk)(" 加入購物車 "),x={class:"col-12 col-md-5"},$=(0,s.Uk)(" cart "),V={key:0,class:"text-center"},q={class:"table align-middle"},D=(0,s._)("thead",null,[(0,s._)("tr",null,[(0,s._)("th"),(0,s._)("th",null,"名稱"),(0,s._)("th",{style:{width:"120px"}},"數量"),(0,s._)("th",null,"單價")])],-1),L=["onClick"],P=(0,s._)("i",{class:"bi bi-x"},null,-1),U=[P],z={key:0,class:"text-success"},W={class:"input-group input-group-sm"},I=["onUpdate:modelValue","disabled","onChange"],M={class:"input-group-text"},S={key:0,class:"text-success"},Z=(0,s._)("td",{colspan:"3",class:"text-end"},"總計",-1),E={class:"text-end"},H={key:0},Y=(0,s._)("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),A={class:"text-end text-success"},K={class:"input-group mb-3 input-group-sm"},j={class:"input-group-append"},O={key:0,class:"col-12"},B={class:"container p-3"},N={class:"mb-3"},F=(0,s._)("label",{for:"email",class:"form-label"},"Email",-1),G={class:"mb-3"},J=(0,s._)("label",{for:"name",class:"form-label"},"收件人姓名",-1),Q={class:"mb-3"},R=(0,s._)("label",{for:"tel",class:"form-label"},"收件人電話",-1),T={class:"mb-3"},X=(0,s._)("label",{for:"address",class:"form-label"},"收件人地址",-1),ee={class:"mb-3"},te=(0,s._)("label",{for:"message",class:"form-label"},"留言",-1),ae={class:"mb-3 d-flex"},se=["onClick"];function le(e,t,a,C,P,le){const ie=(0,s.up)("loading-component"),oe=(0,s.up)("pagination-bar"),ne=(0,s.up)("vee-field"),re=(0,s.up)("error-message"),de=(0,s.up)("vee-form");return(0,s.wg)(),(0,s.iD)("div",o,[(0,s._)("div",n,[(0,s.Wm)(ie,{active:P.isLoading},null,8,["active"]),(0,s._)("div",r,[(0,s._)("div",d,[(0,s._)("table",c,[u,(0,s._)("tbody",null,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(P.products,(t=>((0,s.wg)(),(0,s.iD)("tr",{key:t.id},[(0,s._)("td",p,[(0,s._)("div",{style:(0,l.j5)([{height:"100px","background-size":"cover","background-position":"center"},{backgroundImage:`url(${t.imageUrl})`}])},null,4)]),(0,s._)("td",null,[(0,s._)("a",m,(0,l.zw)(t.title),1)]),(0,s._)("td",null,[t.price?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("div",h,(0,l.zw)(e.$filters.currency(t.origin_price))+" 元",1)),t.price?((0,s.wg)(),(0,s.iD)("del",g,"原價"+(0,l.zw)(e.$filters.currency(t.origin_price))+" 元",1)):(0,s.kq)("",!0),t.price?((0,s.wg)(),(0,s.iD)("div",_,"現在特價 "+(0,l.zw)(e.$filters.currency(t.price))+" 元",1)):(0,s.kq)("",!0)]),(0,s._)("td",null,[(0,s._)("div",v,[(0,s._)("button",{type:"button",class:"btn btn-outline-secondary",onClick:(0,i.iM)((e=>le.getProduct(t.id)),["prevent"])},"查看更多",8,b),(0,s._)("button",{type:"button",class:"btn btn-outline-danger",disabled:this.status.loadingItem===t.id,onClick:(0,i.iM)((e=>le.addCart(t.id)),["prevent"])},[this.status.loadingItem===t.id?((0,s.wg)(),(0,s.iD)("div",k,y)):(0,s.kq)("",!0),w],8,f)])])])))),128))])])])]),(0,s.Wm)(oe,{pages:P.pagination,onEmitPages:le.getProducts},null,8,["pages","onEmitPages"])]),(0,s._)("div",x,[$,P.cartShow?((0,s.wg)(),(0,s.iD)(s.HY,{key:1},[(0,s._)("button",{type:"button",class:"btn btn-danger",onClick:t[0]||(t[0]=(0,i.iM)(((...e)=>le.deleteAllCart&&le.deleteAllCart(...e)),["prevent"]))},"清空購物車"),(0,s._)("table",q,[D,(0,s._)("tbody",null,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(P.cart.carts,(t=>((0,s.wg)(),(0,s.iD)("tr",{key:t.id},[(0,s._)("td",null,[(0,s._)("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:(0,i.iM)((e=>le.deleteCart(t.id)),["prevent"])},U,8,L)]),(0,s._)("td",null,[(0,s.Uk)((0,l.zw)(t.product.title)+" ",1),t.coupon?((0,s.wg)(),(0,s.iD)("div",z," 已套用優惠券 "+(0,l.zw)(t.coupon.title),1)):(0,s.kq)("",!0)]),(0,s._)("td",null,[(0,s._)("div",W,[(0,s.wy)((0,s._)("input",{type:"number",class:"form-control","onUpdate:modelValue":e=>t.qty=e,min:"1",disabled:t.id===P.status.loadingItem,onChange:e=>le.updateCart(t)},null,40,I),[[i.nr,t.qty]]),(0,s._)("div",M,"/ "+(0,l.zw)(t.product.unit),1)])]),(0,s._)("td",null,[t.coupon?((0,s.wg)(),(0,s.iD)("small",S,"折扣價：")):(0,s.kq)("",!0),(0,s.Uk)((0,l.zw)(e.$filters.currency(t.final_total)),1)])])))),128))]),(0,s._)("tfoot",null,[(0,s._)("tr",null,[Z,(0,s._)("td",E,(0,l.zw)(e.$filters.currency(P.cart.total)),1)]),P.cart.total>P.cart.final_total?((0,s.wg)(),(0,s.iD)("tr",H,[Y,(0,s._)("td",A,(0,l.zw)(e.$filters.currency(P.cart.final_total)),1)])):(0,s.kq)("",!0)])]),(0,s._)("div",K,[(0,s.wy)((0,s._)("input",{type:"text",class:"form-control",placeholder:"請輸入優惠碼","onUpdate:modelValue":t[1]||(t[1]=e=>P.voucherCode=e)},null,512),[[i.nr,P.voucherCode]]),(0,s._)("div",j,[(0,s._)("button",{class:"btn btn-outline-secondary",type:"button",onClick:t[2]||(t[2]=(0,i.iM)(((...e)=>le.addVoucherCode&&le.addVoucherCode(...e)),["prevent"]))}," 套用優惠碼 ")])])],64)):((0,s.wg)(),(0,s.iD)("div",V," 目前購物車內是空的 "))]),P.cartShow?((0,s.wg)(),(0,s.iD)("div",O,[(0,s._)("div",B,[(0,s.Wm)(de,{onSubmit:le.createOrder},{default:(0,s.w5)((({errors:e,validate:a})=>[(0,s._)("div",N,[F,(0,s.Wm)(ne,{type:"email",class:(0,l.C_)(["form-control",{"is-invalid":e["email"]}]),id:"email",placeholder:"請輸入Email",name:"email",required:"",rules:"email|required",modelValue:P.form.user.email,"onUpdate:modelValue":t[3]||(t[3]=e=>P.form.user.email=e)},null,8,["class","modelValue"]),(0,s.Wm)(re,{name:"email",class:"invalid-feedback"})]),(0,s._)("div",G,[J,(0,s.Wm)(ne,{type:"text",class:(0,l.C_)(["form-control",{"is-invalid":e["name"]}]),id:"name",placeholder:"請輸入姓名",name:"name",required:"",rules:"required",modelValue:P.form.user.name,"onUpdate:modelValue":t[4]||(t[4]=e=>P.form.user.name=e)},null,8,["class","modelValue"]),(0,s.Wm)(re,{name:"name",class:"invalid-feedback"})]),(0,s._)("div",Q,[R,(0,s.Wm)(ne,{type:"text",class:(0,l.C_)(["form-control",{"is-invalid":e["tel"]}]),id:"tel",placeholder:"請輸入電話",name:"tel",required:"",rules:le.isPhone,modelValue:P.form.user.tel,"onUpdate:modelValue":t[5]||(t[5]=e=>P.form.user.tel=e)},null,8,["rules","class","modelValue"]),(0,s.Wm)(re,{name:"tel",class:"invalid-feedback"})]),(0,s._)("div",T,[X,(0,s.Wm)(ne,{type:"text",class:(0,l.C_)(["form-control",{"is-invalid":e["address"]}]),id:"address",placeholder:"請輸入收件地址",name:"address",required:"",rules:"required",modelValue:P.form.user.address,"onUpdate:modelValue":t[6]||(t[6]=e=>P.form.user.address=e)},null,8,["class","modelValue"]),(0,s.Wm)(re,{name:"address",class:"invalid-feedback"})]),(0,s._)("div",ee,[te,(0,s.Wm)(ne,{class:"form-control",id:"message",rows:"3",name:"message",modelValue:P.form.message,"onUpdate:modelValue":t[7]||(t[7]=e=>P.form.message=e)},null,8,["modelValue"])]),(0,s._)("div",ae,[(0,s._)("button",{type:"submit",class:"btn btn-primary ms-auto",onClick:a},"送出訂單",8,se)])])),_:1},8,["onSubmit"])])])):(0,s.kq)("",!0)])}var ie=a(5820),oe=a(9637),ne={data(){return{products:[],product:{},status:{loadingItem:""},isLoading:!1,pagination:{},cart:{},cartShow:!1,voucherCode:"",form:{user:{name:"",email:"",tel:"",address:""},message:""}}},components:{PaginationBar:oe.Z},provide(){return{emitter:ie.Z}},methods:{getProducts(e=1){const t=`https://vue3-course-api.hexschool.io/api/steven-vue3-demo/products/?page=${e}`;this.isLoading=!0,this.$http.get(t).then((e=>{console.log(e.data.products),this.products=e.data.products,this.pagination=e.data.pagination,this.isLoading=!1}))},getProduct(e){this.$router.push(`/user/product/${e}`)},addCart(e){const t="https://vue3-course-api.hexschool.io/api/steven-vue3-demo/cart";this.status.loadingItem=e;const a={product_id:e,qty:1};this.$http.post(t,{data:a}).then((e=>{console.log(e),ie.Z.emit("updateCart"),this.status.loadingItem="",this.getCart()}))},getCart(){const e="https://vue3-course-api.hexschool.io/api/steven-vue3-demo/cart";this.isLoading=!0,this.$http.get(e).then((e=>{console.log(e.data),this.cart=e.data.data,this.isLoading=!1,this.cartShow=!1,e.data.data.carts.length>0&&(this.cartShow=!0)}))},updateCart(e){const t=`https://vue3-course-api.hexschool.io/api/steven-vue3-demo/cart/${e.id}`,a={product_id:e.product_id,qty:e.qty};this.isLoading=!0,this.status.loadingItem=e.id,this.$http.put(t,{data:a}).then((e=>{this.isLoading=!1,this.getCart(),this.status.loadingItem=""}))},deleteCart(e){const t=`https://vue3-course-api.hexschool.io/api/steven-vue3-demo/cart/${e}`;this.isLoading=!0,this.$http.delete(t).then((e=>{this.isLoading=!1,ie.Z.emit("updateCart"),this.getCart()}))},deleteAllCart(){const e="https://vue3-course-api.hexschool.io/api/steven-vue3-demo/carts";this.isLoading=!0,this.$http.delete(e).then((e=>{this.$httpMessageState(e,"清空購物車"),this.isLoading=!1,ie.Z.emit("updateCart"),this.getCart()}))},addVoucherCode(){const e="https://vue3-course-api.hexschool.io/api/steven-vue3-demo/coupon",t={code:this.voucherCode};this.isLoading=!0,this.$http.post(e,{data:t}).then((e=>{console.log(e),this.$httpMessageState(e,"使用優惠券"),this.isLoading=!1,this.getCart()}))},createOrder(){const e="https://vue3-course-api.hexschool.io/api/steven-vue3-demo/order",t=this.form;this.isLoading=!0,this.$http.post(e,{data:t}).then((e=>{console.log(e.data.orderId),this.$httpMessageState(e,"新增訂單"),this.isLoading=!1,this.getCart(),this.form={user:{name:"",email:"",tel:"",address:""},message:""},this.$router.push(`/user/checkout/${e.data.orderId}`)}))},isPhone(e){const t=/^(09)[0-9]{8}$/;return!!t.test(e)||"手機號碼格式錯誤"}},created(){this.getProducts(),this.getCart()}},re=a(89);const de=(0,re.Z)(ne,[["render",le]]);var ce=de}}]);
//# sourceMappingURL=627.572ad952.js.map